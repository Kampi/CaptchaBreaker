import sys
import argparse

from CaptchaSolver.CaptchaSolver import CaptchaSolver

DemoFolder = "D:\\Dropbox\\GitHub\\Machine-Learning\\Captcha-Solver\\data\\"
ModelPath = DemoFolder + "model\\CaptchaSolver.hdf5" 

# Check the version of python
if(sys.version_info <= (3, 6, 2)):
    print("Python Version: {}".format(sys.version))
    print("Version not supported!")
    exit()

Solver = CaptchaSolver(28, 28, 1, 30)

# Set commandline arguments
ArgParser = argparse.ArgumentParser()
ArgParser.add_argument("-m", "--mode", choices = ["demo", "live"], help = "Select the application mode", default = "demo")
ArgParser.add_argument("-w", "--model", choices = ["train", "load"], help = "Select if the CNN should be learned or loaded from file", default = "train")
args = vars(ArgParser.parse_args())

if(args["mode"] == "demo"):
    print("Use demo mode")

    if(args["model"] == "train"):
        Solver.LoadTrainingData(DemoFolder + "train", DemoFolder + "preprocessing", RandomState = 42)
        Solver.TrainModel()
    elif(args["model"] == "load"):
        Solver.LoadModel(ModelPath)
    else:
        pass
   
    #Solver.SaveModel(ModelPath)
    #Solver.Plot()
    #Solver.PrintModel("D:\\Dropbox\\GitHub\\Machine-Learning\\Captcha-Solver\\doc\\Model.jpg")

    print("[INFO] Start prediction...")
    print("[INFO] Load test captcha...")
    Solver.Predict("D:\\Dropbox\\GitHub\\Machine-Learning\\Captcha-Solver\\data\\test\\900")

else:
    print("Use live mode")
